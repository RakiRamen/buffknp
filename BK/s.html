<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF14 ã‚«ãƒ³ãƒšã‚¨ãƒ‡ã‚£ã‚¿ Compact</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .icon-btn:hover { transform: scale(1.1); filter: brightness(1.2); }
        /* é…ç½®å¾Œã®ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’30pxã«ç¸®å° */
        .buff-icon { width: 30px; height: 30px; cursor: pointer; transition: transform 0.1s; }
        .buff-icon:hover { transform: scale(1.1); opacity: 0.7; }
        .selected-row { background-color: #f0f7ff; border-left: 3px solid #3b82f6; }
        input::placeholder { color: #cbd5e1; font-size: 0.7rem; }
        .custom-scroll::-webkit-scrollbar { height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        /* å…¥åŠ›æ¬„ã®æ ã‚’ç´°ãã—ã¦é«˜ã•ã‚’æŠ‘ãˆã‚‹ */
        input { height: 28px; }
    </style>
</head>
<body class="bg-slate-100 p-2 md:p-4 pb-44">

    <div class="max-w-6xl mx-auto bg-white p-3 rounded-lg shadow-xl">
        <div class="flex flex-wrap items-center justify-between gap-2 mb-2 border-b pb-2">
            <div class="flex items-center gap-3">
                <h1 class="text-xl font-black text-slate-800 tracking-tighter">FF14 KANPE</h1>
                <div class="flex items-center bg-slate-100 p-0.5 rounded border">
                    <input id="bossName" type="text" class="bg-transparent px-2 py-0 outline-none w-32 text-xs" placeholder="ãƒœã‚¹å...">
                    <button onclick="saveData()" class="bg-emerald-600 text-white px-3 py-1 rounded hover:bg-emerald-700 font-bold text-xs">ğŸ’¾ ä¿å­˜</button>
                </div>
            </div>

            <div class="flex items-center gap-1">
                <select id="saveList" class="p-1 border rounded bg-white text-xs outline-none">
                    <option value="">-- ä¿å­˜æ¸ˆ --</option>
                </select>
                <button onclick="loadData()" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 font-bold text-xs">ğŸ“‚ èª­è¾¼</button>
                <button onclick="clearCurrentTable(true)" class="bg-slate-500 text-white px-2 py-1 rounded hover:bg-slate-600 font-bold text-xs">ğŸ†• æ–°è¦</button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full border-collapse">
                <thead>
                    <tr class="text-slate-500 text-[10px] uppercase tracking-wider border-b">
                        <th class="p-1 w-1/4 text-left font-bold">æ•µã®æŠ€å</th>
                        <th class="p-1 text-left font-bold">ãƒãƒ•ãƒ»è»½æ¸›</th>
                        <th class="p-1 w-1/4 text-left font-bold">å‚™è€ƒ</th>
                        <th class="p-1 w-8"></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    </tbody>
            </table>
        </div>

        <button onclick="addRow()" class="mt-2 w-full py-1 border border-dashed border-slate-300 rounded text-slate-400 hover:bg-slate-50 hover:text-blue-500 transition-all text-xs font-bold">
            ï¼‹ è¡Œã‚’è¿½åŠ 
        </button>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-slate-900 p-2 shadow-2xl">
        <div class="max-w-6xl mx-auto">
            <div class="flex gap-1.5 mb-2 overflow-x-auto custom-scroll pb-1">
                <button onclick="showJob('TANK')" class="whitespace-nowrap bg-blue-900 text-white px-3 py-0.5 rounded-full text-[10px] hover:bg-blue-700">ã‚¿ãƒ³ã‚¯å…±é€š</button>
                <button onclick="showJob('PLD')" class="whitespace-nowrap bg-blue-800 text-white px-3 py-0.5 rounded-full text-[10px] hover:bg-blue-600">ãƒŠã‚¤ãƒˆ</button>
                <button onclick="showJob('WAR')" class="whitespace-nowrap bg-red-950 text-white px-3 py-0.5 rounded-full text-[10px] hover:bg-red-800">æˆ¦å£«</button>
                <button onclick="showJob('HEALER')" class="whitespace-nowrap bg-green-900 text-white px-3 py-0.5 rounded-full text-[10px] hover:bg-green-700">ãƒ’ãƒ¼ãƒ©ãƒ¼</button>
                <button onclick="showJob('DPS')" class="whitespace-nowrap bg-red-900 text-white px-3 py-0.5 rounded-full text-[10px] hover:bg-red-700">DPSå…±é€š</button>
            </div>
            
            <div id="iconPalette" class="flex flex-wrap gap-2 items-center min-h-[40px]"></div>
        </div>
    </div>

    <script>
        // è¨­å®šï¼šç”»åƒãƒ•ã‚¡ã‚¤ãƒ«åã‚’è‡ªåˆ†ã®iconsãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã«åˆã‚ã›ã¦æ›¸ãæ›ãˆã¦ãã ã•ã„
        const JOB_DATA = {
            TANK: [
                { name: 'ãƒªãƒ—ãƒ©ã‚¤ã‚¶ãƒ«', file: 'reprisal.png' },
                { name: 'ãƒ©ãƒ³ãƒ‘ãƒ¼ãƒˆ', file: 'rampart.png' },
                { name: 'ã‚¢ãƒ¼ãƒ ã‚ºãƒ¬ãƒ³ã‚°ã‚¹', file: 'armslength.png' },
                { name: 'æŒ‘ç™º', file: 'shirk.png' }
            ],
            PLD: [
                { name: 'ã‚»ãƒ³ãƒãƒãƒ«', file: 'sentinel.png' },
                { name: 'ãƒ›ãƒ¼ãƒªãƒ¼ã‚·ã‚§ãƒ«ãƒˆãƒ­ãƒ³', file: 'sheltron.png' },
                { name: 'ãƒ‡ã‚£ãƒ´ã‚¡ã‚¤ãƒ³ãƒ´ã‚§ãƒ¼ãƒ«', file: 'veil.png' },
                { name: 'ãƒ‘ãƒƒã‚»ãƒ¼ã‚¸ãƒ»ã‚ªãƒ–ãƒ»ã‚¢ãƒ¼ãƒ ã‚º', file: 'passage.png' }
            ],
            WAR: [
                { name: 'ãƒ´ã‚§ãƒ³ã‚¸ã‚§ãƒ³ã‚¹', file: 'vengeance.png' },
                { name: 'åŸåˆã®ç›´æ„Ÿ', file: 'raw_intuition.png' },
                { name: 'ã‚·ã‚§ã‚¤ã‚¯ã‚ªãƒ•', file: 'shakeoff.png' },
                { name: 'ãƒ›ãƒ«ãƒ ã‚®ãƒ£ãƒ³ã‚°', file: 'holm.png' }
            ],
            HEALER: [
                { name: 'å …å®Ÿé­”', file: 'surecast.png' },
                { name: 'ãƒ«ãƒ¼ã‚·ãƒƒãƒ‰ãƒ‰ãƒªãƒ¼ãƒ ', file: 'lucid.png' },
                { name: 'è¿…é€Ÿé­”', file: 'swiftcast.png' }
            ],
            DPS: [
                { name: 'ç‰½åˆ¶', file: 'feint.png' },
                { name: 'ã‚¢ãƒ‰ãƒ«', file: 'addle.png' },
                { name: 'å†…ä¸¹', file: 'second_wind.png' }
            ]
        };

        let currentRowId = null;

        window.onload = () => {
            updateSaveList();
            showJob('TANK');
            addRow(); 
        };

        function addRow(enemySkill = '', buffs = [], memo = '') {
            const tbody = document.getElementById('tableBody');
            const rowId = 'row-' + Date.now() + Math.random().toString(36).substr(2, 5);
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-100 hover:bg-slate-50 transition-colors";
            tr.id = rowId;
            tr.onclick = () => selectRow(rowId);

            tr.innerHTML = `
                <td class="p-1"><input type="text" class="w-full px-2 bg-slate-50 border border-slate-200 rounded text-xs text-enemy outline-none focus:bg-white focus:ring-1 focus:ring-blue-400" value="${enemySkill}" placeholder="æŠ€å..."></td>
                <td class="p-1"><div class="flex flex-wrap gap-0.5 buff-container min-h-[32px] items-center p-0.5 bg-slate-50 rounded border border-slate-100"></div></td>
                <td class="p-1"><input type="text" class="w-full px-2 bg-slate-50 border border-slate-200 rounded text-xs text-memo outline-none focus:bg-white focus:ring-1 focus:ring-blue-400" value="${memo}" placeholder="å‚™è€ƒ..."></td>
                <td class="p-1 text-center">
                    <button onclick="document.getElementById('${rowId}').remove()" class="text-slate-300 hover:text-red-500 transition text-[10px]">âœ•</button>
                </td>
            `;
            
            tbody.appendChild(tr);
            const container = tr.querySelector('.buff-container');
            buffs.forEach(fileName => addIconElement(container, fileName));
            selectRow(rowId);
        }

        function selectRow(id) {
            currentRowId = id;
            document.querySelectorAll('#tableBody tr').forEach(r => r.classList.remove('selected-row'));
            const selected = document.getElementById(id);
            if (selected) selected.classList.add('selected-row');
        }

        function showJob(jobKey) {
            const palette = document.getElementById('iconPalette');
            palette.innerHTML = '';
            JOB_DATA[jobKey].forEach(icon => {
                const img = document.createElement('img');
                img.src = `icons/${icon.file}`;
                img.className = "icon-btn w-9 h-9 cursor-pointer rounded bg-slate-800 p-0.5 shadow border border-slate-700";
                img.title = icon.name;
                img.onclick = () => addIconToCurrentRow(icon.file);
                palette.appendChild(img);
            });
        }

        function addIconToCurrentRow(fileName) {
            if (!currentRowId) return;
            const container = document.querySelector(`#${currentRowId} .buff-container`);
            addIconElement(container, fileName);
        }

        function addIconElement(container, fileName) {
            const img = document.createElement('img');
            img.src = `icons/${fileName}`;
            img.className = "buff-icon rounded";
            img.onclick = (e) => { e.stopPropagation(); img.remove(); };
            container.appendChild(img);
        }

        function saveData() {
            const bossName = document.getElementById('bossName').value.trim();
            if (!bossName) { alert("ãƒœã‚¹åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
            const data = [];
            document.querySelectorAll('#tableBody tr').forEach(tr => {
                const enemySkill = tr.querySelector('.text-enemy').value;
                const memo = tr.querySelector('.text-memo').value;
                const buffs = [];
                tr.querySelectorAll('.buff-container img').forEach(img => {
                    buffs.push(img.src.split('/').pop());
                });
                data.push({ enemySkill, buffs, memo });
            });
            localStorage.setItem(`ff14_kanpe_${bossName}`, JSON.stringify(data));
            updateSaveList();
            alert(`ã€Œ${bossName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
        }

        function loadData() {
            const bossName = document.getElementById('saveList').value;
            if (!bossName) return;
            const saved = localStorage.getItem(`ff14_kanpe_${bossName}`);
            if (saved) {
                clearCurrentTable(false);
                JSON.parse(saved).forEach(row => addRow(row.enemySkill, row.buffs, row.memo));
                document.getElementById('bossName').value = bossName;
            }
        }

        function updateSaveList() {
            const select = document.getElementById('saveList');
            select.innerHTML = '<option value="">-- ä¿å­˜æ¸ˆ --</option>';
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('ff14_kanpe_')) {
                    const name = key.replace('ff14_kanpe_', '');
                    select.add(new Option(name, name));
                }
            }
        }

        function clearCurrentTable(isNew) {
            document.getElementById('tableBody').innerHTML = '';
            if (isNew) {
                document.getElementById('bossName').value = '';
                addRow();
            }
        }
    </script>
</body>
</html>
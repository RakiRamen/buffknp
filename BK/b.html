<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FF14 KANPE - Highlight Row</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .icon-btn:hover { transform: scale(1.1); filter: brightness(1.2); }
        .buff-icon { width: 32px; height: 32px; cursor: pointer; }
        
        /* --- ãƒã‚¤ãƒ©ã‚¤ãƒˆè¨­å®š --- */
        .selected-row { 
            background-color: #dbeafe !important; /* æ˜ã‚‹ã„é’ */
            outline: 2px solid #3b82f6;
            z-index: 10;
        }
        .selected-row input { 
            font-weight: bold !important; 
            color: #1e40af !important; 
        }
        /* -------------------- */

        .compact-input { height: 36px; font-size: 14px; border: none; background: transparent; transition: all 0.2s; }
        .compact-input:focus { background: white; outline: 1px solid #3b82f6; }
        
        .dragging { opacity: 0.5; background-color: #e2e8f0; }
        .drag-handle { cursor: grab; color: #cbd5e1; user-select: none; }
        
        .custom-scroll::-webkit-scrollbar { height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
    </style>
</head>
<body class="bg-slate-100 p-2 pb-44 text-slate-900">

    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-sm">
        <div class="flex items-center justify-between p-2 border-b bg-slate-50 flex-wrap gap-2">
            <div class="flex items-center gap-2">
                <span class="font-black text-slate-700 text-sm italic">FF14 KANPE</span>
                <input id="bossName" type="text" class="border px-2 py-1 w-40 text-xs font-bold border-blue-200 outline-none" placeholder="ãƒœã‚¹åã‚’å…¥åŠ›...">
                <button onclick="saveData()" class="bg-emerald-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-emerald-700">ğŸ’¾ ä¿å­˜ / è¤‡è£½</button>
            </div>
            
            <div class="flex items-center gap-1 bg-slate-200 p-1 rounded">
                <select id="saveList" class="border text-xs p-1 rounded min-w-[120px] outline-none"></select>
                <button onclick="loadData()" class="bg-blue-600 text-white px-3 py-1 rounded text-xs font-bold hover:bg-blue-700">ğŸ“‚ èª­è¾¼</button>
                <button onclick="deleteData()" class="bg-white text-red-600 border border-red-200 px-2 py-1 rounded text-xs font-bold hover:bg-red-50">ğŸ—‘ï¸ å‰Šé™¤</button>
                <button onclick="clearCurrentTable(true)" class="bg-slate-500 text-white px-2 py-1 rounded text-xs hover:bg-slate-600 ml-2">ğŸ†• æ–°è¦</button>
            </div>
        </div>

        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-slate-800 text-white text-[10px] font-bold">
                    <th class="border border-slate-700 w-8 p-1"></th>
                    <th class="border border-slate-700 w-1/4 p-1">æ•µã®æŠ€å</th>
                    <th class="border border-slate-700 p-1">ãƒãƒ•ãƒ»è»½æ¸›</th>
                    <th class="border border-slate-700 w-1/4 p-1">å‚™è€ƒ</th>
                    <th class="border border-slate-700 w-8 p-1"></th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>

        <button onclick="addRow()" class="w-full py-2 bg-slate-50 text-slate-500 hover:bg-slate-100 text-xs border-t font-bold">
            ï¼‹ è¡Œã‚’è¿½åŠ 
        </button>
    </div>

    <div class="fixed bottom-0 left-0 right-0 bg-slate-900 p-2 shadow-2xl z-50">
        <div class="max-w-6xl mx-auto">
            <div class="flex gap-1 mb-2 overflow-x-auto custom-scroll pb-1">
                <button onclick="showJob('TANK')" class="bg-blue-900 text-white px-3 py-1 rounded-sm text-[10px]">ã‚¿ãƒ³ã‚¯</button>
                <button onclick="showJob('PLD')" class="bg-blue-800 text-white px-3 py-1 rounded-sm text-[10px]">ãƒŠã‚¤ãƒˆ</button>
                <button onclick="showJob('WAR')" class="bg-red-950 text-white px-3 py-1 rounded-sm text-[10px]">æˆ¦å£«</button>
                <button onclick="showJob('HEALER')" class="bg-green-900 text-white px-3 py-1 rounded-sm text-[10px]">ãƒ’ãƒ©</button>
                <button onclick="showJob('DPS')" class="bg-red-900 text-white px-3 py-1 rounded-sm text-[10px]">DPS</button>
            </div>
            <div id="iconPalette" class="flex flex-wrap gap-1 items-center min-h-[44px]"></div>
        </div>
    </div>

    <script>
        const JOB_DATA = {
            TANK: [{name:'ãƒªãƒ—',file:'reprisal.png'}, {name:'ãƒ©ãƒ³ãƒ‘',file:'rampart.png'}, {name:'ã‚¢ãƒ ãƒ¬ãƒ³',file:'armslength.png'}],
            PLD: [{name:'ã‚»ãƒ³ãƒ†ã‚£',file:'sentinel.png'}, {name:'ã‚·ã‚§ãƒ«',file:'sheltron.png'}, {name:'ãƒ´ã‚§ãƒ¼ãƒ«',file:'veil.png'}],
            WAR: [{name:'ãƒ´ã‚§ãƒ³ã‚¸ã‚§',file:'vengeance.png'}, {name:'ç›´æ„Ÿ',file:'raw_intuition.png'}, {name:'ãƒ›ãƒ«ãƒ ',file:'holm.png'}],
            HEALER: [{name:'å …å®Ÿ',file:'surecast.png'}, {name:'ãƒ«ãƒ¼ã‚·ãƒƒãƒ‰',file:'lucid.png'}],
            DPS: [{name:'ç‰½åˆ¶',file:'feint.png'}, {name:'ã‚¢ãƒ‰ãƒ«',file:'addle.png'}]
        };

        let currentRowId = null;

        window.onload = () => { updateSaveList(); showJob('TANK'); addRow(); initDragAndDrop(); };

        function addRow(enemySkill = '', buffs = [], memo = '') {
            const tbody = document.getElementById('tableBody');
            const rowId = 'row-' + Date.now() + Math.random().toString(36).substr(2, 5);
            const tr = document.createElement('tr');
            tr.className = "border-b border-slate-200 transition-all draggable-row";
            tr.id = rowId;
            tr.draggable = true;
            tr.onclick = () => selectRow(rowId);

            tr.innerHTML = `
                <td class="border p-0 text-center drag-handle font-bold text-slate-400 hover:text-slate-600">â ¿</td>
                <td class="border p-0"><input type="text" class="w-full px-2 compact-input text-enemy outline-none" value="${enemySkill}" placeholder="æŠ€å"></td>
                <td class="border p-0"><div class="flex flex-wrap gap-0.5 buff-container min-h-[36px] items-center px-1"></div></td>
                <td class="border p-0"><input type="text" class="w-full px-2 compact-input text-memo outline-none" value="${memo}" placeholder="å‚™è€ƒ"></td>
                <td class="border p-0 text-center"><button onclick="document.getElementById('${rowId}').remove()" class="text-slate-300 hover:text-red-500 text-xs px-2">âœ•</button></td>
            `;
            
            tbody.appendChild(tr);
            const container = tr.querySelector('.buff-container');
            buffs.forEach(fileName => addIconElement(container, fileName));
            selectRow(rowId);
        }

        function initDragAndDrop() {
            const tbody = document.getElementById('tableBody');
            tbody.addEventListener('dragstart', (e) => {
                const target = e.target.closest('tr');
                if (target) { target.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; }
            });
            tbody.addEventListener('dragend', (e) => {
                const target = e.target.closest('tr');
                if (target) target.classList.remove('dragging');
            });
            tbody.addEventListener('dragover', (e) => {
                e.preventDefault();
                const draggingRow = document.querySelector('.dragging');
                const target = e.target.closest('tr');
                if (target && target !== draggingRow) {
                    const rect = target.getBoundingClientRect();
                    const next = (e.clientY - rect.top) / (rect.bottom - rect.top) > 0.5;
                    tbody.insertBefore(draggingRow, next ? target.nextSibling : target);
                }
            });
        }

        function selectRow(id) {
            currentRowId = id;
            document.querySelectorAll('#tableBody tr').forEach(r => r.classList.remove('selected-row'));
            const selected = document.getElementById(id);
            if (selected) {
                selected.classList.add('selected-row');
                // é¸æŠã—ãŸè¡Œã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ã‚‹ï¼ˆä»»æ„ï¼‰
                selected.querySelector('.text-enemy').focus();
            }
        }

        function showJob(jobKey) {
            const palette = document.getElementById('iconPalette');
            palette.innerHTML = '';
            JOB_DATA[jobKey].forEach(icon => {
                const img = document.createElement('img');
                img.src = `icons/${icon.file}`;
                img.className = "icon-btn w-10 h-10 cursor-pointer rounded bg-slate-800 p-0.5 border border-slate-700";
                img.onclick = (e) => { e.stopPropagation(); addIconToCurrentRow(icon.file); };
                palette.appendChild(img);
            });
        }

        function addIconToCurrentRow(fileName) {
            if (!currentRowId) return;
            addIconElement(document.querySelector(`#${currentRowId} .buff-container`), fileName);
        }

        function addIconElement(container, fileName) {
            const img = document.createElement('img');
            img.src = `icons/${fileName}`;
            img.className = "buff-icon";
            img.onclick = (e) => { e.stopPropagation(); img.remove(); };
            container.appendChild(img);
        }

        function saveData() {
            const bossName = document.getElementById('bossName').value.trim();
            if (!bossName) return alert("ãƒœã‚¹åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            const data = Array.from(document.querySelectorAll('#tableBody tr')).map(tr => ({
                enemySkill: tr.querySelector('.text-enemy').value,
                memo: tr.querySelector('.text-memo').value,
                buffs: Array.from(tr.querySelectorAll('.buff-container img')).map(img => img.src.split('/').pop())
            }));
            localStorage.setItem(`ff14_kanpe_${bossName}`, JSON.stringify(data));
            updateSaveList();
            alert(`ã€Œ${bossName}ã€ã‚’ä¿å­˜ã—ã¾ã—ãŸ`);
        }

        function loadData() {
            const bossName = document.getElementById('saveList').value;
            const saved = localStorage.getItem(`ff14_kanpe_${bossName}`);
            if (saved) {
                document.getElementById('tableBody').innerHTML = '';
                JSON.parse(saved).forEach(row => addRow(row.enemySkill, row.buffs, row.memo));
                document.getElementById('bossName').value = bossName;
            }
        }

        function deleteData() {
            const bossName = document.getElementById('saveList').value;
            if (!bossName || !confirm(`ã€Œ${bossName}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) return;
            localStorage.removeItem(`ff14_kanpe_${bossName}`);
            updateSaveList();
            clearCurrentTable(true);
        }

        function updateSaveList() {
            const select = document.getElementById('saveList');
            select.innerHTML = '<option value="">-- ä¿å­˜æ¸ˆãƒ‡ãƒ¼ã‚¿ --</option>';
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('ff14_kanpe_')) keys.push(key.replace('ff14_kanpe_', ''));
            }
            keys.sort().forEach(name => select.add(new Option(name, name)));
        }

        function clearCurrentTable(isNew) {
            document.getElementById('tableBody').innerHTML = '';
            if (isNew) { document.getElementById('bossName').value = ''; addRow(); }
        }
    </script>
</body>
</html>